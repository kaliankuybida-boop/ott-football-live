<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>Football Live — TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      background: #111;
      color: #eee;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }
    #player {
      width: 100%;
      height: 500px;
      border-radius: 8px;
      overflow: hidden;
    }
    .channels {
      margin-top: 24px;
    }
    .channels-title {
      font-weight: 700;
      margin-bottom: 12px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 10px;
    }
    .tile {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 8px;
      background: rgba(255,255,255,0.06);
      cursor: pointer;
      transition: background 0.15s ease, border 0.15s ease;
      border: 2px solid transparent;
    }
    .tile:hover { background: rgba(0,255,106,0.15); }
    .tile img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      border-radius: 6px;
      background: #000;
    }
    .ch-name { font-weight: 600; }
    .active { border-color: #00ff6a; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Football Live</h1>

    <div id="player"></div>

    <div class="channels">
      <h2 class="channels-title">Канали</h2>
      <div id="channelsGrid" class="grid"></div>
    </div>
  </div>

  <script src="playerjs.js" type="text/javascript"></script>

  <script>
    const params = new URLSearchParams(window.location.search);
    const login = params.get('login');
    const password = params.get('password');

    const isFreeAccess = login === 'Free' && password === 'Free';
    const playlistURL = isFreeAccess
      ? 'https://www.dropbox.com/scl/fi/58i8lqt149rwspks85lqd/Free-1.m3u8?rlkey=w9fl3mhi3oxe4mhwguyuep5sx&st=2qe5j9nr&dl=1'
      : `https://s-footballive.pp.ua:8000/playlist.m3u8?username=${encodeURIComponent(login||'')}&password=${encodeURIComponent(password||'')}`;

    let activeTile = null;
    let player;

    function parseM3U(text) {
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      const items = [];
      let current = null;
      for (const line of lines) {
        if (line.startsWith('#EXTINF')) {
          const nameMatch = line.match(/,(.*)$/);
          const name = nameMatch ? nameMatch[1].trim() : 'Канал';
          const attrs = {};
          const attrMatches = [...line.matchAll(/([a-zA-Z0-9_-]+)="([^"]*)"/g)];
          for (const m of attrMatches) attrs[m[1]] = m[2];
          current = { name, attrs, url: null };
        } else if (!line.startsWith('#')) {
          if (current) {
            current.url = line;
            items.push(current);
            current = null;
          }
        }
      }
      return items;
    }

    async function loadChannels() {
      try {
        const res = await fetch(playlistURL);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const text = await res.text();
        const channels = parseM3U(text);

        if (!channels.length) return;

        const grid = document.getElementById('channelsGrid');
        grid.innerHTML = '';

        channels.forEach((ch, index) => {
          const tile = document.createElement('div');
          tile.className = 'tile';
          const logo = ch.attrs['tvg-logo'] || '';

          tile.innerHTML = `
            <img src="${logo}" alt="logo" onerror="this.style.display='none';">
            <div class="ch-name">${ch.name}</div>
          `;

          tile.addEventListener('click', () => playChannel(ch.url, tile));
          grid.appendChild(tile);

          if (index === 0) {
            playChannel(ch.url, tile);
          }
        });
      } catch (e) {
        console.warn('Помилка завантаження каналів:', e.message);
      }
    }

    function playChannel(url, tile) {
      if (activeTile) activeTile.classList.remove('active');
      activeTile = tile;
      activeTile.classList.add('active');

      if (!player) {
        player = new Playerjs({id: "player", file: url});
      } else {
        player.api("file", url);
        player.api("play");
      }
    }

    if (login && password) {
      loadChannels();
    } else {
      console.warn('Не передано логін або пароль у параметрах URL.');
    }
  </script>
</body>
</html>
